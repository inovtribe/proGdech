{% extends 'GeographProgdechBundle:Backend:backend_layout.html.twig' %}
{% set adminMenu = true %}

{% block title %}Détail d'un point de collecte{% endblock %}

{% block content %}
<h2>{{ block('title') }}</h2>
{% for flashMessage in app.session.flashbag.get('success') %}
<div class="alert alert-success">
    {{ flashMessage }}
</div>
{% endfor %}
<div class="row">
    <div class="col-md-6">
        <h3>{{ pointcollecte.nom }}</h3>
        <p>{{ pointcollecte.reference }}</p>
        <p>{{ pointcollecte.adresse }}</p>
        <p><a href="{{ app.request.basepath }}/admin/commune/{{ pointcollecte.commune.insee }}">{{ pointcollecte.commune.nom }}</a></p>
        <p>Nombre d'emplacements : {{ pointcollecte.emplacement }} (points de colelctes affectés affecté(s) | points de colelcte emplacements vides disponible(s))</p>
        <p>Créé le date par <a href="{{ app.request.basepath }}/admin/user/{{ pointcollecte.user.id }}">{{ pointcollecte.user.prenom }} {{ user.nom }}</a></p>
    </div>
    <div class="col-md-6">
        <div id="map" class="h400"></div>
    </div>
    {% autoescape %}
        <script>
            {{ include('/backend/inc/script_carte.js') }}
            
            markeractif = L.icon({
                iconUrl: '{{ markeractif.filename|raw }}',

                iconSize:     {{ markeractif.size|raw }},
                iconAnchor:   {{ markeractif.anchor|raw }},
                popupAnchor:  {{ markeractif.popupanchor|raw }}
            });
            markerinactif = L.icon({
                iconUrl: '{{ markerinactif.filename|raw }}',

                iconSize:     {{ markerinactif.size|raw }},
                iconAnchor:   {{ markerinactif.anchor|raw }},
                popupAnchor:  {{ markerinactif.popupanchor|raw }}
            });
            marker{{ pointcollecte.id }} = L.marker([{{ pointcollecte.latitude }}, {{ pointcollecte.longitude }}], {icon: markeractif}).bindPopup("<a href=\"{{ app.request.basepath }}/admin/pointcollecte/{{ pointcollecte.id }}\">{{ pointcollecte.nom }}</a>").addTo(map);
            map.setView([{{ pointcollecte.latitude }}, {{ pointcollecte.longitude }}],15);
            {% for item in pointscollecte %}
                marker{{ item.id}} = L.marker([{{ item.latitude }}, {{ item.longitude }}], {icon: markerinactif}).bindPopup("<a href=\"{{ app.request.basepath }}/admin/pointcollecte/{{ item.id }}\">{{ item.nom }}</a>").addTo(map);
            {% endfor %}
            map.fitBounds(marker{{ pointcollecte.id }}.getBounds()).setMaxBounds(geojson.getBounds());
        </script>
    {% endautoescape %}

</div>
<div class="row">
    <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Liste des bacs
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="dataTable_wrapper">
                        <table class="table table-striped table-bordered table-hover" id="dataTables-example">
                            <thead>
                                <tr>
                                    <th class="text-center">Réference</th>
                                    <th class="text-center">Emplacement</th>
                                    <th class="text-center">Date de création</th>
                                    <th class="text-center">Modele</th>
                                    <th class="text-center">Tournée</th>
                                    <th class="text-right col-5"></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if bacs %}
                                    {% for bac in bacs %}
                                    <tr class="odd gradeX">
                                        <td><a href="{{ app.request.basepath }}/admin/bac/{{ bac.id }}">{{ bac.reference }}</a></td>
                                        <td>{{ bac.emplacement }}</td>
                                        <td>{{ bac.date }}</td>
                                        <td></td>
                                        <td></td>
                                        <td>
                                            <a href="/admin/bac/{{ bac.id }}/edit" class="btn btn-info btn-xs" title="Editer"><span class="glyphicon glyphicon-edit"></span></a>
                                            <button type="button" class="btn btn-danger btn-xs" title="Delete" data-toggle="modal" data-target="#bacDialog{{ bac.id }}"><span class="glyphicon glyphicon-remove"></span></button>
                                            <div class="modal fade" id="bacDialog{{ bac.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                            <h4 class="modal-title" id="myModalLabel">Confirmation nécessaire</h4>
                                                        </div>
                                                        <div class="modal-body">
                                                            Voulez allez libérer l'emplacement occupé par ce bac ?
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                                                            <a href="/admin/bac/{{ bac.id }}/dereferencer/{{ pointcollecte.id }}" class="btn btn-danger">Confirmer</a>
                                                        </div>
                                                    </div><!-- /.modal-content -->
                                                </div><!-- /.modal-dialog -->
                                            </div><!-- /.modal -->
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    {% if pointcollecte.emplacementsvides > 0 %}
                                    <tr>
                                        <td colspan="5"><button type="button" class="btn btn-success btn-xs" title="Référencer un bac" data-toggle="modal" data-target="#referencerbac"><span class="glyphicon glyphicon-plus"></span></button> Affecter un bac<td>
                                    </tr>
                                    {% endif %}
                                {% else %}
                                    <tr>
                                        <td colspan="5"><button type="button" class="btn btn-success btn-xs" title="Référencer un bac" data-toggle="modal" data-target="#referencerbac"><span class="glyphicon glyphicon-plus"></span></button> Il n'y a aucun bacs affecté à ce point de collecte<td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <!-- /.table-responsive -->
                    <div class="modal fade" id="referencerbac" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModalLabel">Selection d'un bac</h4>
                                </div>
                                
                                {{ form_start(referencebacForm, { 'attr': {'class': 'form-horizontal'} }) }}
                                    <div class="form-group">
                                        {{ form_label(referencebacForm.reference, null, { 'label_attr':  {
                                            'class': 'col-sm-4 control-label'
                                        }}) }}
                                        <div class="col-sm-6">
                                            {{ form_errors(referencebacForm.reference) }}
                                            {{ form_widget(referencebacForm.reference, { 'attr':  {
                                                'class': 'form-control'
                                            }}) }}
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-7 col-sm-5">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                                            <input type="submit" class="btn btn-primary" value="Ajouter" />
                                        </div>
                                    </div>
                                {{ form_end(referencebacForm) }}
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal-dialog -->
                    </div><!-- /.modal -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
</div>
<!-- /.row -->

{% endblock %}